# B2: プルーフ選択画面 — Claude Code 実装指示書

## ⚠️ 最初にやること
1. CLAUDE.md を読む
2. このファイルを全部読む
3. 実装計画を見せる（コードはまだ書かない）

---

## 概要

ダッシュボード（dashboard/page.tsx）に「プルーフ設定」セクションを追加する。
プロが「クライアントに投票してもらう強み項目」を選ぶ画面。

---

## 要件

### データ取得
- `proof_items` テーブルから全件取得（70項目、7カテゴリ）
- `sort_order` 昇順で取得
- カテゴリ: basic / body_pro / yoga / pilates / esthe / sports / education

### UI構造
```
プルーフ設定セクション
  ├── ヘッダー（説明テキスト）
  ├── 選択プログレスバー（6/8 + バー）
  ├── カテゴリタブ（7個、横スクロール対応）
  │     └── タブ上にバッジ（そのカテゴリの選択数）
  ├── 項目リスト（チェックボックス × 10項目）
  ├── カスタム項目セクション（テキスト入力、最大3個）
  ├── 注記テキスト
  ├── 保存ボタン
  └── 選択中の項目一覧（タグ表示）
```

### 選択ルール
- 全70項目 + カスタム項目から **合計最大8個**
- カスタムは **最大3個**（8個枠に含む）
- 8個到達 → 未選択項目はグレーアウト + disabled
- タブを切り替えても選択状態は保持
- カスタムの空文字はカウントしない・保存しない

### 保存先
```
professionals テーブル:
  - selected_proofs: uuid[]     ← proof_items.id の配列
  - custom_proofs: jsonb        ← [{"id": "custom_xxx", "label": "テキスト"}, ...]
```

### 初期値ロード
- professionals テーブルから selected_proofs と custom_proofs を取得
- `.maybeSingle()` を使う（.single() は禁止）
- 既存の選択を復元してチェック状態に反映

### 固定項目について
- 「期待できそう！」「特にない」は **この画面に表示しない**
- 投票画面（C1）で自動表示される
- 注記テキストで説明: 「※ "期待できそう！" と "特にない" はすべてのプロに自動で表示されます」

---

## デザイン仕様

### カラー（REALPROOF ブランド）
- Dark: #1A1A2E（タブ選択時の文字、保存ボタン背景）
- Gold: #C4A35A（チェックボックス選択、プログレスバー満タン時、タブアンダーライン）
- Cream: #FAFAF7（ページ背景、入力欄背景）
- White: #FFFFFF（カード背景）
- Gray系: #E5E7EB（ボーダー）、#9CA3AF（サブテキスト）、#6B7280（プレースホルダー）

### タブ
- 非選択: グレーテキスト、下線なし
- 選択: ダークテキスト(bold)、ゴールドの下線 2px
- バッジ（選択数）: 選択タブ=ゴールド背景白文字、非選択タブ=グレー
- 横スクロール対応（モバイル）

### チェックボックス
- 未選択: 白背景、グレーボーダー、角丸6px
- 選択: ゴールド背景、白チェックマーク
- disabled: opacity 0.4

### プログレスバー
- 8未満: ダークグラデーション
- 8到達: ゴールドグラデーション
- 高さ6px、角丸

### 保存ボタン
- 通常: ダーク背景、ゴールド文字
- 保存成功: グリーン背景に切替 → 2.5秒後に戻る
- 角丸12px、letter-spacing 1px

### カスタム項目
- テキスト入力欄: Cream背景、フォーカス時ゴールドボーダー
- 削除ボタン: ✕、グレーボーダー
- 追加ボタン: ダッシュボーダー、ホバーでゴールド

### 選択一覧（画面下部）
- プリセット項目: ゴールド薄背景、ダーク文字、pill形状
- カスタム項目: ゴールド濃背景、ゴールド文字、pill形状

### 絵文字は使わない（テキストのみでクリーン）

---

## タブ名マッピング

```typescript
const CATEGORY_LABELS: Record<string, string> = {
  basic: "基本",
  body_pro: "ボディプロ",
  yoga: "ヨガ",
  pilates: "ピラティス",
  esthe: "エステ",
  sports: "スポーツ",
  education: "教育",
};
```

---

## エッジケース

| ケース | 対応 |
|--------|------|
| proof_items テーブルが空 | 「項目を読み込めませんでした」表示 |
| 8個選択済みでタブ移動 | 他タブの未選択もグレーアウト |
| カスタム3個 + プリセット5個 = 8個 | 追加選択不可 |
| カスタム入力が空文字のみ | 保存時に除外、カウントにも含めない |
| DBに保存済みの selected_proofs に、proof_items から削除された id が含まれる | 無視して新しいリストだけ表示 |
| ネットワークエラーで保存失敗 | エラーメッセージ表示 |

---

## 実装上の注意

1. **dashboard/page.tsx に追加**する（新ファイルではなく既存に追加）
2. コンポーネント分割はMVP段階では不要。インラインでOK
3. `getSession()` を使う（`getUser()` 禁止）
4. `.maybeSingle()` を使う（`.single()` 禁止）
5. Tailwind CSS でスタイリング（インラインstyleではなくTailwind classを使う）
6. 保存後に `npm run build` が通ることを確認してからコミット
7. 1つの修正 = 1コミット

---

## テスト確認項目

- [ ] 70項目が7タブに正しく表示される
- [ ] タブ切替で選択状態が保持される
- [ ] 8個上限で未選択項目がdisabledになる
- [ ] カスタム追加/削除でカウントが正しく更新される
- [ ] 保存 → リロード → 選択が復元される
- [ ] npm run build が通る
